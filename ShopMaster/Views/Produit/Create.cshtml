@using ShopMaster.Models.DTO
@model ProduitDto

@{
    ViewData["Title"] = "Ajouter un produit";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Ajouter un produit</h4>
                </div>
                <div class="card-body">
                    <form asp-action="Create" method="post" enctype="multipart/form-data" novalidate>
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                        <!-- Nom du produit -->
                        <div class="mb-3">
                            <label asp-for="Nom" class="form-label fw-bold">
                                <i class="fas fa-tag me-1"></i>Nom du produit
                            </label>
                            <input asp-for="Nom" class="form-control" placeholder="Entrez le nom du produit" />
                            <span asp-validation-for="Nom" class="text-danger small"></span>
                        </div>

                        <!-- Marque -->
                        <div class="mb-3">
                            <label asp-for="Marque" class="form-label fw-bold">
                                <i class="fas fa-trademark me-1"></i>Marque
                            </label>
                            <input asp-for="Marque" class="form-control" placeholder="Entrez la marque" />
                            <span asp-validation-for="Marque" class="text-danger small"></span>
                        </div>

                        <!-- Quantité et Prix sur la même ligne -->
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="qte" class="form-label fw-bold">
                                        <i class="fas fa-boxes me-1"></i>Quantité
                                    </label>
                                    <input asp-for="qte" type="number" class="form-control"
                                           placeholder="Quantité" min="1" max="999" />
                                    <span asp-validation-for="qte" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label asp-for="Prix" class="form-label fw-bold">
                                        <i class="fas fa-euro-sign me-1"></i>Prix (€)
                                    </label>
                                    <input asp-for="Prix" type="number" step="0.01" class="form-control"
                                           placeholder="0.00" min="0.01" max="999999.99" />
                                    <span asp-validation-for="Prix" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label asp-for="Description" class="form-label fw-bold">
                                <i class="fas fa-align-left me-1"></i>Description
                            </label>
                            <textarea asp-for="Description" class="form-control" rows="3"
                                      placeholder="Décrivez le produit..."></textarea>
                            <span asp-validation-for="Description" class="text-danger small"></span>
                        </div>

                        <!-- Image -->
                        <div class="mb-4">
                            <label asp-for="ImageUrl" class="form-label fw-bold">
                                <i class="fas fa-image me-1"></i>Image du produit
                            </label>
                            <input asp-for="ImageUrl" type="file" class="form-control"
                                   accept="image/*" />
                            <div class="form-text">
                                <small class="text-muted">Formats acceptés : JPG, PNG, GIF (optionnel)</small>
                            </div>
                            <span asp-validation-for="ImageUrl" class="text-danger small"></span>
                        </div>

                        <!-- Boutons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a asp-action="Index" class="btn btn-secondary me-md-2">
                                <i class="fas fa-times me-1"></i>Annuler
                            </a>
                            <button type="submit" class="btn btn-primary" asp-controller="Produit" asp-action="create">
                                <i class="fas fa-save me-1"></i>Enregistrer
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        // Validation en temps réel avec Bootstrap
        (function() {
            'use strict';

            // Sélectionner tous les formulaires avec validation
            var forms = document.querySelectorAll('form[novalidate]');

            // Boucler sur chaque formulaire
            Array.prototype.slice.call(forms)
                .forEach(function(form) {
                    form.addEventListener('submit', function(event) {
                        if (!form.checkValidity()) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });

            // Validation en temps réel sur les champs
            var inputs = document.querySelectorAll('input, textarea, select');
            inputs.forEach(function(input) {
                input.addEventListener('blur', function() {
                    if (input.checkValidity()) {
                        input.classList.remove('is-invalid');
                        input.classList.add('is-valid');
                    } else {
                        input.classList.remove('is-valid');
                        input.classList.add('is-invalid');
                    }
                });

                input.addEventListener('input', function() {
                    if (input.classList.contains('is-invalid') && input.checkValidity()) {
                        input.classList.remove('is-invalid');
                        input.classList.add('is-valid');
                    }
                });
            });

            // Preview de l'image
            var imageInput = document.querySelector('input[type="file"]');
            if (imageInput) {
                imageInput.addEventListener('change', function(e) {
                    var file = e.target.files[0];
                    if (file) {
                        var reader = new FileReader();
                        reader.onload = function(e) {
                            // Créer ou mettre à jour l'aperçu
                            var preview = document.getElementById('image-preview');
                            if (!preview) {
                                preview = document.createElement('div');
                                preview.id = 'image-preview';
                                preview.className = 'mt-2';
                                imageInput.parentNode.appendChild(preview);
                            }
                            preview.innerHTML = '<img src="' + e.target.result + '" class="img-thumbnail" style="max-width: 200px; max-height: 200px;" alt="Aperçu">';
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
        })();
    </script>
}

<style>
    .card {
        border: none;
        border-radius: 10px;
    }

    .card-header {
        border-radius: 10px 10px 0 0 !important;
    }

    .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    .is-valid {
        border-color: #198754;
    }

    .is-invalid {
        border-color: #dc3545;
    }

    .form-label {
        color: #495057;
    }

    .btn {
        border-radius: 6px;
    }

    .shadow {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
    }
</style>